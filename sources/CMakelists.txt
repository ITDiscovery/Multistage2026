cmake_minimum_required(VERSION 3.10)
project(Multistage2026)

# ==============================================================================
# 1. Project Configuration
# ==============================================================================

# Tell CMake to use C++17 standard (modern features)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

# Define the output definition (Must be SHARED for Orbiter Modules)
add_library(Multistage2026 SHARED
    sources/Multistage2026.cpp
    sources/parser.cpp
    sources/Guidance.cpp
    sources/Particles.cpp
    sources/peg.cpp
)

# ==============================================================================
# 2. Include Directories
# ==============================================================================

# Point the compiler to your headers
target_include_directories(Multistage2026 PRIVATE
    sources
    simpleini
    Orbitersdk/include
)

# ==============================================================================
# 3. Compiler Flags (Linux/GCC Specifics)
# ==============================================================================

if(UNIX)
    # Orbiter expects specific definitions
    target_compile_definitions(Multistage2026 PRIVATE
        ORBITER_MODULE
    )

    # Compiler flags to keep the code clean but permissive regarding legacy syntax
    target_compile_options(Multistage2026 PRIVATE
        -fPIC                   # Position Independent Code (Required for .so)
        -w                      # Suppress warnings for the first build (keeps output clean)
        -D_GNU_SOURCE           # Enable standard Linux math constants
    )
endif()

# ==============================================================================
# 4. Output Location
# ==============================================================================

# This will put the compiled .so file in a "Modules" folder, ready to copy to Orbiter
set_target_properties(Multistage2026 PROPERTIES
    PREFIX ""                   # Don't add "lib" to the start (e.g. libMultistage.so -> Multistage.so)
    SUFFIX ".so"                # Extension
    LIBRARY_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/Modules
)
